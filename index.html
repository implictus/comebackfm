<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FM Tuner Controller</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #F8F9FA;
      color: #212529;
      padding: 20px;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
    }

    .header {
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #212529;
    }

    .header p {
      font-size: 14px;
      color: #6C757D;
    }

    .panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .config-field {
      margin-bottom: 16px;
    }

    .config-field:last-child {
      margin-bottom: 0;
    }

    .config-field label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      margin-bottom: 6px;
    }

    .config-field input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #DEE2E6;
      border-radius: 6px;
      font-size: 14px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: border-color 0.3s;
    }

    .config-field input:focus {
      outline: none;
      border-color: #007BFF;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }

    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      flex: 1;
      min-width: 100px;
    }

    .button-primary {
      background-color: #007BFF;
      color: white;
    }

    .button-primary:hover {
      background-color: #0056B3;
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
    }

    .button-primary:active {
      transform: scale(0.98);
    }

    .button-secondary {
      background-color: #6C757D;
      color: white;
    }

    .button-secondary:hover {
      background-color: #5A6268;
      box-shadow: 0 2px 8px rgba(108, 117, 125, 0.2);
    }

    .button-success {
      background-color: #28A745;
      color: white;
    }

    .button-success:hover {
      background-color: #218838;
      box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
    }

    .button-success:active {
      transform: scale(0.98);
    }

    .control-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .control-buttons .button {
      flex: none;
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .button:disabled:hover {
      background-color: inherit;
      box-shadow: none;
    }

    .status {
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 4px;
      margin-top: 12px;
      display: none;
    }

    .status-success {
      background-color: #D4EDDA;
      color: #155724;
      border: 1px solid #C3E6CB;
    }

    .status-error {
      background-color: #F8D7DA;
      color: #721C24;
      border: 1px solid #F5C6CB;
    }

    .status-info {
      background-color: #D1ECF1;
      color: #0C5460;
      border: 1px solid #BEE5EB;
    }

    #iframeContainer {
      width: 100%;
      height: 0;
      border-radius: 8px;
      overflow: hidden;
      transition: height 0.3s;
    }

    #iframeContainer.loaded {
      height: 600px;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .debug-console {
      background-color: #1E1E1E;
      color: #00FF00;
      padding: 16px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      line-height: 1.5;
    }

    .debug-console-line {
      margin: 4px 0;
      padding: 2px 0;
    }

    .debug-console-line.error {
      color: #FF6B6B;
    }

    .debug-console-line.success {
      color: #51CF66;
    }

    .debug-console-line.info {
      color: #74C0FC;
    }

    .debug-console-line.warning {
      color: #FFD93D;
    }

    .clear-console-btn {
      margin-top: 12px;
      width: 100%;
    }

    .emoji {
      margin-right: 4px;
    }

    .info-text {
      font-size: 13px;
      color: #6C757D;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéôÔ∏è FM Tuner Controller</h1>
      <p>Control the FM tuner across origins using postMessage API</p>
    </div>

    <!-- Config Panel -->
    <div class="panel">
      <div class="panel-title">
        <span class="emoji">‚öôÔ∏è</span>Configuration
      </div>
      <div class="config-field">
        <label for="iframeUrl">Iframe URL:</label>
        <input 
          type="text" 
          id="iframeUrl" 
          value="https://comebackfm.fmtuner.org/" 
          placeholder="Enter FM tuner URL"
        >
      </div>
      <div class="button-group">
        <button class="button button-primary" onclick="loadIframe()">Load Iframe</button>
        <button class="button button-secondary" id="focusBtn" onclick="focusIframe()" disabled>Focus Iframe</button>
      </div>
      <div id="configStatus" class="status"></div>
    </div>

    <!-- Controls Panel -->
    <div class="panel">
      <div class="panel-title">
        <span class="emoji">üéöÔ∏è</span>Keyboard Controls
      </div>
      <p class="info-text">
        Click buttons or press keys to simulate F1-F4 keypresses on the FM tuner
      </p>
      <div class="control-buttons">
        <button class="button button-success" onclick="dispatchKey(112, 'F1')">F1</button>
        <button class="button button-success" onclick="dispatchKey(113, 'F2')">F2</button>
        <button class="button button-success" onclick="dispatchKey(114, 'F3')">F3</button>
        <button class="button button-success" onclick="dispatchKey(115, 'F4')">F4</button>
      </div>
      <div id="controlStatus" class="status"></div>
    </div>

    <!-- Iframe Container -->
    <div class="panel">
      <div class="panel-title">
        <span class="emoji">üì∫</span>Target Iframe (FM-Tuner)
      </div>
      <div id="iframeContainer"></div>
    </div>

    <!-- Debug Console -->
    <div class="panel">
      <div class="panel-title">
        <span class="emoji">üîç</span>Debug Console
      </div>
      <div class="debug-console" id="debugConsole"></div>
      <button class="button button-secondary clear-console-btn" onclick="clearConsole()">Clear Console</button>
    </div>
  </div>

  <script>
    let iframeElement = null;
    let iframeLoaded = false;

    function getTimestamp() {
      return new Date().toLocaleTimeString();
    }

    function log(message, type = 'info') {
      const debugConsoleElement = document.getElementById('debugConsole');
      const line = document.createElement('div');
      line.className = `debug-console-line ${type}`;
      
      const timestamp = getTimestamp();
      let emoji = 'üìù';
      if (type === 'error') emoji = '‚ùå';
      else if (type === 'success') emoji = '‚úÖ';
      else if (type === 'warning') emoji = '‚ö†Ô∏è';
      else if (type === 'info') emoji = '‚ÑπÔ∏è';
      
      line.textContent = `[${timestamp}] ${emoji} ${message}`;
      debugConsoleElement.appendChild(line);
      debugConsoleElement.scrollTop = debugConsoleElement.scrollHeight;
      
      // Log to browser console
      if (type === 'error') {
        window.console.error(`[${type.toUpperCase()}] ${message}`);
      } else {
        window.console.log(`[${type.toUpperCase()}] ${message}`);
      }
    }

    function clearConsole() {
      document.getElementById('debugConsole').innerHTML = '';
      log('Console cleared - Ready for new events', 'info');
    }

    function showStatus(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      element.className = `status status-${type}`;
      element.textContent = message;
      element.style.display = 'block';
      setTimeout(() => {
        element.style.display = 'none';
      }, 4000);
    }

    function loadIframe() {
      const url = document.getElementById('iframeUrl').value.trim();
      
      if (!url) {
        log('Error: Please enter a valid URL', 'error');
        showStatus('configStatus', '‚ùå Please enter a valid URL', 'error');
        return;
      }

      const container = document.getElementById('iframeContainer');
      container.innerHTML = '';
      
      iframeElement = document.createElement('iframe');
      iframeElement.src = url;
      
      try {
        iframeElement.sandbox.add('allow-same-origin', 'allow-scripts', 'allow-forms', 'allow-popups');
      } catch (e) {
        // Sandbox attribute might not support add method in some browsers
        iframeElement.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-forms allow-popups');
      }
      
      iframeElement.onload = function() {
        iframeLoaded = true;
        document.getElementById('focusBtn').disabled = false;
        log(`Iframe loaded from: ${url}`, 'success');
        showStatus('configStatus', '‚úÖ Iframe loaded successfully', 'success');
        container.classList.add('loaded');
      };

      iframeElement.onerror = function() {
        log(`Error loading iframe from: ${url}`, 'error');
        showStatus('configStatus', '‚ùå Failed to load iframe', 'error');
      };

      container.appendChild(iframeElement);
      log(`Loading iframe from: ${url}`, 'info');
    }

    function focusIframe() {
      if (!iframeLoaded || !iframeElement) {
        log('Iframe not loaded yet', 'error');
        showStatus('configStatus', '‚ùå Iframe not loaded', 'error');
        return;
      }

      try {
        iframeElement.focus();
        log('Iframe focused', 'success');
        showStatus('controlStatus', '‚úÖ Iframe focused', 'success');
      } catch (error) {
        log(`Error focusing iframe: ${error.message}`, 'error');
        showStatus('controlStatus', '‚ùå Failed to focus iframe', 'error');
      }
    }

    function dispatchKey(keyCode, keyName) {
      if (!iframeLoaded || !iframeElement) {
        log(`Cannot dispatch ${keyName}: Iframe not loaded`, 'error');
        showStatus('controlStatus', '‚ùå Iframe not loaded', 'error');
        return;
      }

      try {
        log(`‚¨ÜÔ∏è DISPATCHING [${keyName}] to iframe via postMessage`, 'info');
        log(`Event: keyCode=${keyCode}, keyName="${keyName}"`, 'info');

        iframeElement.contentWindow.postMessage(
          {
            type: 'simulateKeyPress',
            keyCode: keyCode,
            keyName: keyName,
            key: keyName,
            bubbles: true,
            cancelable: true
          },
          '*'
        );

        log(`${keyName} event dispatched successfully`, 'success');
        showStatus('controlStatus', `‚úÖ ${keyName} dispatched`, 'success');
      } catch (error) {
        log(`Error dispatching ${keyName}: ${error.message}`, 'error');
        showStatus('controlStatus', `‚ùå Error dispatching ${keyName}`, 'error');
      }
    }

    window.addEventListener('message', function(event) {
      if (event.data.type === 'iframeLog') {
        log(`[IFRAME] ${event.data.message}`, 'info');
      } else if (event.data.type === 'iframeError') {
        log(`[IFRAME ERROR] ${event.data.message}`, 'error');
      }
    });

    document.addEventListener('keydown', function(event) {
      const keyMap = {
        'F1': function() { dispatchKey(112, 'F1'); },
        'F2': function() { dispatchKey(113, 'F2'); },
        'F3': function() { dispatchKey(114, 'F3'); },
        'F4': function() { dispatchKey(115, 'F4'); }
      };

      if (keyMap[event.key]) {
        event.preventDefault();
        keyMap[event.key]();
      }
    });

    log('FM Tuner Controller initialized', 'success');
    log('Enter iframe URL and click "Load Iframe" to start', 'info');
  </script>
</body>
</html>
