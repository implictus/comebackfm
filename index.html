<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1-F4 Keyboard Event Sender - Debug</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9f9f9;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 350px 1fr 1fr;
            gap: 20px;
        }

        .control-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #0052cc;
            border-bottom: 2px solid #0052cc;
            padding-bottom: 8px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .key-button {
            background: linear-gradient(135deg, #0052cc 0%, #003d99 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .key-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 82, 204, 0.3);
        }

        .key-button:active {
            transform: translateY(0);
            background: linear-gradient(135deg, #003d99 0%, #002966 100%);
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #333;
        }

        .input-group input {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.85rem;
            font-family: monospace;
        }

        .input-group input:focus {
            outline: none;
            border-color: #0052cc;
            box-shadow: 0 0 4px rgba(0, 82, 204, 0.3);
        }

        .load-button {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .load-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .status-box {
            background: #f0f7ff;
            border-left: 4px solid #0052cc;
            padding: 12px;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .status-box.loading {
            background: #fff3cd;
            border-left-color: #ff9800;
        }

        .status-box.error {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .status-box.success {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }

        .iframe-container {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .iframe-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }

        #targetIframe {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 4px;
        }

        .console-panel {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .console-header .title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #0052cc;
        }

        .clear-button {
            background: #ff6700;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s ease;
        }

        .clear-button:hover {
            background: #e55a00;
        }

        #consoleOutput {
            background: #1e1e1e;
            color: #0ff;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            height: 600px;
            overflow-y: auto;
            line-height: 1.4;
            border: 1px solid #333;
        }

        .log-entry {
            margin-bottom: 6px;
            word-break: break-word;
        }

        .log-info {
            color: #0ff;
        }

        .log-error {
            color: #ff4444;
        }

        .log-success {
            color: #44ff44;
        }

        .log-warning {
            color: #ffaa00;
        }

        .log-sent {
            color: #00ddff;
        }

        .log-received {
            color: #88ff88;
        }

        .timestamp {
            color: #888;
            font-size: 0.75em;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .stat-item {
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0052cc;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .stat-value {
            color: #0052cc;
            font-weight: bold;
            font-size: 1.1em;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .control-panel {
                position: static;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <div>
                <div class="section-title">‚å®Ô∏è Controls</div>
                <div class="button-grid">
                    <button class="key-button" data-key="F1">F1</button>
                    <button class="key-button" data-key="F2">F2</button>
                    <button class="key-button" data-key="F3">F3</button>
                    <button class="key-button" data-key="F4">F4</button>
                </div>
            </div>

            <div class="input-section">
                <div class="section-title">‚öôÔ∏è Config</div>
                <div class="input-group">
                    <label for="iframeUrl">Iframe URL:</label>
                    <input 
                        type="text" 
                        id="iframeUrl" 
                        placeholder="https://..."
                        value="https://comebackfm.fmtuner.org/"
                    >
                </div>
                <button class="load-button" id="loadIframeButton">
                    Load Iframe
                </button>
            </div>

            <div id="statusBox" class="status-box">
                <strong>Status:</strong> Ready
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Sent:</div>
                    <div class="stat-value" id="sentCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Received:</div>
                    <div class="stat-value" id="receivedCount">0</div>
                </div>
            </div>

            <div class="input-section">
                <div class="section-title">üîß Test</div>
                <button class="load-button" id="testMessageButton" style="background: #ff9800;">
                    Test postMessage
                </button>
            </div>
        </div>

        <!-- Iframe Container -->
        <div class="iframe-container">
            <div class="iframe-label">üì∫ Target Iframe (Cross-Origin)</div>
            <iframe 
                id="targetIframe" 
                src="https://comebackfm.fmtuner.org/"
                title="Target webpage"
                sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"
            ></iframe>
        </div>

        <!-- Console Panel -->
        <div class="console-panel">
            <div class="console-header">
                <span class="title">üìã Debug Console</span>
                <button class="clear-button">Clear</button>
            </div>
            <div id="consoleOutput"></div>
        </div>
    </div>

    <script>
        // Advanced Console Logger
        class ConsoleLogger {
            constructor(outputElementId) {
                this.outputElement = document.getElementById(outputElementId);
                this.logs = [];
                this.sentCount = 0;
                this.receivedCount = 0;
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString('nl-NL', { hour12: false });
                const logEntry = { message, type, timestamp };
                this.logs.push(logEntry);
                this.render();
                console.log(`[${type.toUpperCase()}] ${message}`);
            }

            info(message) { this.log(message, 'info'); }
            error(message) { this.log(message, 'error'); }
            success(message) { this.log(message, 'success'); }
            warning(message) { this.log(message, 'warning'); }
            sent(message) { 
                this.sentCount++; 
                this.log(message, 'sent');
                this.updateStats();
            }
            received(message) { 
                this.receivedCount++; 
                this.log(message, 'received');
                this.updateStats();
            }

            clear() {
                this.logs = [];
                this.sentCount = 0;
                this.receivedCount = 0;
                this.render();
                this.updateStats();
            }

            render() {
                this.outputElement.innerHTML = this.logs
                    .map(log => {
                        const classList = `log-entry log-${log.type}`;
                        return `<div class="${classList}"><span class="timestamp">[${log.timestamp}]</span> ${this.escapeHtml(log.message)}</div>`;
                    })
                    .join('');
                this.outputElement.scrollTop = this.outputElement.scrollHeight;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            updateStats() {
                document.getElementById('sentCount').textContent = this.sentCount;
                document.getElementById('receivedCount').textContent = this.receivedCount;
            }
        }

        // Initialize
        const logger = new ConsoleLogger('consoleOutput');
        const keyButtons = document.querySelectorAll('.key-button[data-key]');
        const targetIframe = document.getElementById('targetIframe');
        const clearButton = document.querySelector('.clear-button');
        const loadIframeButton = document.getElementById('loadIframeButton');
        const testMessageButton = document.getElementById('testMessageButton');
        const iframeUrlInput = document.getElementById('iframeUrl');
        const statusBox = document.getElementById('statusBox');

        logger.info('‚úÖ Keyboard Event Debugger initialized');
        logger.info('üéØ Ready to send F1-F4 events via postMessage');

        // Helper function to update status
        function updateStatus(message, type = 'info') {
            statusBox.textContent = 'üîπ ' + message;
            statusBox.className = 'status-box ' + type;
        }

        // Load iframe
        loadIframeButton.addEventListener('click', () => {
            const url = iframeUrlInput.value.trim();
            if (!url) {
                logger.error('‚ùå Please enter a valid URL');
                updateStatus('Error: No URL provided', 'error');
                return;
            }
            try {
                new URL(url);
                targetIframe.src = url;
                updateStatus('Loading iframe...', 'loading');
                logger.info(`üì∫ Loading iframe from: ${url}`);
                
                setTimeout(() => {
                    updateStatus('Iframe loaded - Ready to send events', 'success');
                    logger.success(`‚úÖ Iframe loaded`);
                }, 1500);
            } catch (e) {
                logger.error(`‚ùå Invalid URL: ${e.message}`);
                updateStatus('Error: Invalid URL', 'error');
            }
        });

        // Clear console
        clearButton.addEventListener('click', () => {
            logger.clear();
            updateStatus('Console cleared', 'info');
            logger.info('üìã Console cleared - Ready for new events');
        });

        // Send keyboard event via postMessage
        function sendKeyboardEvent(key) {
            const keyCode = 111 + parseInt(key.slice(1));
            const eventData = {
                type: 'keyboardEvent',
                key: key,
                code: key,
                keyCode: keyCode,
                which: keyCode,
                timestamp: new Date().toISOString(),
                source: 'F-KEY-SENDER'
            };

            logger.sent(`‚¨ÜÔ∏è SENDING [${key}] ‚Üí iframe`);
            logger.info(`   Payload: ${JSON.stringify(eventData)}`);

            // Send postMessage
            try {
                if (targetIframe.contentWindow) {
                    targetIframe.contentWindow.postMessage(eventData, '*');
                    logger.success(`   ‚úì postMessage sent successfully`);
                } else {
                    logger.error('   ‚úó iframe.contentWindow is not available');
                }
            } catch (e) {
                logger.error(`   ‚úó Error sending postMessage: ${e.message}`);
            }

            updateStatus(`Sent: ${key}`, 'success');
        }

        // Button click handlers
        keyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const key = button.dataset.key;
                button.style.transform = 'scale(0.95)';
                sendKeyboardEvent(key);
                setTimeout(() => { button.style.transform = ''; }, 100);
            });
        });

        // Keyboard shortcuts (F1-F4)
        document.addEventListener('keydown', (e) => {
            if (e.key.startsWith('F') && e.key.length === 2) {
                const keyNum = parseInt(e.key.slice(1));
                if (keyNum >= 1 && keyNum <= 4) {
                    e.preventDefault();
                    const button = document.querySelector(`[data-key="${e.key}"]`);
                    if (button) {
                        button.click();
                    }
                }
            }
        });

        // Listen for messages from iframe
        window.addEventListener('message', (event) => {
            logger.received(`‚¨áÔ∏è RECEIVED from iframe`);
            logger.info(`   Origin: ${event.origin}`);
            logger.info(`   Data: ${JSON.stringify(event.data)}`);
            updateStatus(`Response received!`, 'success');
        });

        // Test message button
        testMessageButton.addEventListener('click', () => {
            logger.info('üß™ Testing postMessage communication...');
            const testData = {
                type: 'test',
                message: 'Hello from parent',
                timestamp: new Date().toISOString()
            };
            
            try {
                targetIframe.contentWindow.postMessage(testData, '*');
                logger.sent(`üß™ Test message sent`);
                logger.info(`   Payload: ${JSON.stringify(testData)}`);
                logger.warning('   Waiting for response (listen in iframe console)...');
            } catch (e) {
                logger.error(`Test failed: ${e.message}`);
            }
        });

        // Initial status
        updateStatus('Ready - Click buttons or press F1-F4', 'success');
        logger.success('üöÄ System ready for keyboard events');
    </script>
</body>
</html>
