<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1-F4 Keyboard Event Dispatcher</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9f9f9;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 350px 1fr 1fr;
            gap: 20px;
        }

        .control-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #0052cc;
            border-bottom: 2px solid #0052cc;
            padding-bottom: 8px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .key-button {
            background: linear-gradient(135deg, #0052cc 0%, #003d99 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .key-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 82, 204, 0.3);
        }

        .key-button:active {
            transform: translateY(0);
            background: linear-gradient(135deg, #003d99 0%, #002966 100%);
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #333;
        }

        .input-group input {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.85rem;
            font-family: monospace;
        }

        .input-group input:focus {
            outline: none;
            border-color: #0052cc;
            box-shadow: 0 0 4px rgba(0, 82, 204, 0.3);
        }

        .load-button {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .load-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .status-box {
            background: #f0f7ff;
            border-left: 4px solid #0052cc;
            padding: 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .status-box.loading {
            background: #fff3cd;
            border-left-color: #ff9800;
        }

        .status-box.error {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .status-box.success {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }

        .status-box.warning {
            background: #fff3cd;
            border-left-color: #ff9800;
        }

        .focus-indicator {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .focus-indicator.focused {
            background: #c8e6c9;
            border-left-color: #4caf50;
        }

        .iframe-container {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .iframe-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }

        #targetIframe {
            width: 100%;
            height: 600px;
            border: 3px solid #ddd;
            border-radius: 4px;
            transition: border-color 0.3s ease;
        }

        #targetIframe.focused {
            border-color: #4caf50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
        }

        .console-panel {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .console-header .title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #0052cc;
        }

        .clear-button {
            background: #ff6700;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s ease;
        }

        .clear-button:hover {
            background: #e55a00;
        }

        #consoleOutput {
            background: #1e1e1e;
            color: #0ff;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            height: 600px;
            overflow-y: auto;
            line-height: 1.4;
            border: 1px solid #333;
        }

        .log-entry {
            margin-bottom: 6px;
            word-break: break-word;
        }

        .log-info {
            color: #0ff;
        }

        .log-error {
            color: #ff4444;
        }

        .log-success {
            color: #44ff44;
        }

        .log-warning {
            color: #ffaa00;
        }

        .log-dispatch {
            color: #ffaa00;
        }

        .timestamp {
            color: #888;
            font-size: 0.75em;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .control-panel {
                position: static;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <div>
                <div class="section-title">‚å®Ô∏è Controls</div>
                <div class="button-grid">
                    <button class="key-button" data-key="F1">F1</button>
                    <button class="key-button" data-key="F2">F2</button>
                    <button class="key-button" data-key="F3">F3</button>
                    <button class="key-button" data-key="F4">F4</button>
                </div>
            </div>

            <div class="input-section">
                <div class="section-title">‚öôÔ∏è Config</div>
                <div class="input-group">
                    <label for="iframeUrl">Iframe URL:</label>
                    <input 
                        type="text" 
                        id="iframeUrl" 
                        placeholder="https://..."
                        value="https://comebackfm.fmtuner.org/"
                    >
                </div>
                <button class="load-button" id="loadIframeButton">
                    Load Iframe
                </button>
            </div>

            <div id="statusBox" class="status-box success">
                <strong>Status:</strong> Ready
            </div>

            <div class="focus-indicator" id="focusIndicator">
                üî¥ Iframe NOT focused
            </div>

            <div class="input-section">
                <div class="section-title">üéØ Action</div>
                <button class="load-button" id="focusIframeButton" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">
                    Focus Iframe
                </button>
            </div>
        </div>

        <!-- Iframe Container -->
        <div class="iframe-container">
            <div class="iframe-label">üì∫ Target Iframe (FM-Tuner)</div>
            <iframe 
                id="targetIframe" 
                src="https://comebackfm.fmtuner.org/"
                title="Target webpage"
                sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"
            ></iframe>
        </div>

        <!-- Console Panel -->
        <div class="console-panel">
            <div class="console-header">
                <span class="title">üìã Debug Console</span>
                <button class="clear-button">Clear</button>
            </div>
            <div id="consoleOutput"></div>
        </div>
    </div>

    <script>
        // Console Logger
        class ConsoleLogger {
            constructor(outputElementId) {
                this.outputElement = document.getElementById(outputElementId);
                this.logs = [];
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString('nl-NL', { hour12: false });
                const logEntry = { message, type, timestamp };
                this.logs.push(logEntry);
                this.render();
                console.log(`[${type.toUpperCase()}] ${message}`);
            }

            info(message) { this.log(message, 'info'); }
            error(message) { this.log(message, 'error'); }
            success(message) { this.log(message, 'success'); }
            warning(message) { this.log(message, 'warning'); }
            dispatch(message) { this.log(message, 'dispatch'); }

            clear() {
                this.logs = [];
                this.render();
            }

            render() {
                this.outputElement.innerHTML = this.logs
                    .map(log => {
                        const classList = `log-entry log-${log.type}`;
                        return `<div class="${classList}"><span class="timestamp">[${log.timestamp}]</span> ${this.escapeHtml(log.message)}</div>`;
                    })
                    .join('');
                this.outputElement.scrollTop = this.outputElement.scrollHeight;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize
        const logger = new ConsoleLogger('consoleOutput');
        const keyButtons = document.querySelectorAll('.key-button[data-key]');
        const targetIframe = document.getElementById('targetIframe');
        const clearButton = document.querySelector('.clear-button');
        const loadIframeButton = document.getElementById('loadIframeButton');
        const focusIframeButton = document.getElementById('focusIframeButton');
        const iframeUrlInput = document.getElementById('iframeUrl');
        const statusBox = document.getElementById('statusBox');
        const focusIndicator = document.getElementById('focusIndicator');

        let iframeIsFocused = false;

        logger.info('‚úÖ Keyboard Event Dispatcher initialized');
        logger.info('üéØ Ready to dispatch KeyboardEvent objects');

        // Helper function to update status
        function updateStatus(message, type = 'info') {
            statusBox.textContent = 'üîπ ' + message;
            statusBox.className = 'status-box ' + type;
        }

        // Helper function to update focus indicator
        function updateFocusIndicator() {
            if (iframeIsFocused) {
                focusIndicator.textContent = 'üü¢ Iframe FOCUSED - Ready to dispatch events';
                focusIndicator.classList.add('focused');
            } else {
                focusIndicator.textContent = 'üî¥ Iframe NOT focused - Click "Focus Iframe" first';
                focusIndicator.classList.remove('focused');
            }
        }

        // Load iframe
        loadIframeButton.addEventListener('click', () => {
            const url = iframeUrlInput.value.trim();
            if (!url) {
                logger.error('‚ùå Please enter a valid URL');
                updateStatus('Error: No URL provided', 'error');
                return;
            }
            try {
                new URL(url);
                targetIframe.src = url;
                iframeIsFocused = false;
                updateFocusIndicator();
                updateStatus('Loading iframe...', 'loading');
                logger.info(`üì∫ Loading iframe from: ${url}`);
                
                setTimeout(() => {
                    updateStatus('Iframe loaded - Click "Focus Iframe" to start', 'success');
                    logger.success(`‚úÖ Iframe loaded. Now focus it to dispatch events.`);
                }, 1500);
            } catch (e) {
                logger.error(`‚ùå Invalid URL: ${e.message}`);
                updateStatus('Error: Invalid URL', 'error');
            }
        });

        // Focus iframe button
        focusIframeButton.addEventListener('click', () => {
            try {
                targetIframe.focus();
                iframeIsFocused = true;
                updateFocusIndicator();
                updateStatus('‚úÖ Iframe focused', 'success');
                logger.success(`üéØ Iframe focused! Ready to dispatch keyboard events`);
                targetIframe.classList.add('focused');
            } catch (e) {
                logger.error(`‚ùå Could not focus iframe: ${e.message}`);
                updateStatus('Error: Could not focus', 'error');
            }
        });

        // Dispatch keyboard event
        function dispatchKeyboardEvent(key) {
            if (!iframeIsFocused) {
                logger.warning(`‚ö†Ô∏è  Iframe is not focused! Click "Focus Iframe" first`);
                updateStatus('Error: Iframe not focused', 'warning');
                return;
            }

            const keyCode = 111 + parseInt(key.slice(1));
            
            try {
                logger.dispatch(`‚¨ÜÔ∏è DISPATCHING [${key}] on iframe.contentDocument`);

                // Create KeyboardEvent
                const keydownEvent = new KeyboardEvent('keydown', {
                    key: key,
                    code: key,
                    keyCode: keyCode,
                    which: keyCode,
                    bubbles: true,
                    cancelable: true,
                    view: targetIframe.contentWindow
                });

                logger.info(`   Event created: ${key} (keyCode: ${keyCode})`);
                logger.info(`   Bubbles: true, Cancelable: true`);

                // Dispatch on iframe's document
                const dispatched = targetIframe.contentDocument.dispatchEvent(keydownEvent);
                
                if (dispatched) {
                    logger.success(`   ‚úì Event dispatched successfully!`);
                    updateStatus(`‚úÖ Dispatched ${key}`, 'success');
                } else {
                    logger.warning(`   ‚ö†Ô∏è  Event was cancelled by target`);
                    updateStatus(`‚ö†Ô∏è  Event cancelled`, 'warning');
                }

                // Also dispatch keyup
                const keyupEvent = new KeyboardEvent('keyup', {
                    key: key,
                    code: key,
                    keyCode: keyCode,
                    which: keyCode,
                    bubbles: true,
                    cancelable: true,
                    view: targetIframe.contentWindow
                });

                targetIframe.contentDocument.dispatchEvent(keyupEvent);
                logger.info(`   ‚úì keyup event also dispatched`);

            } catch (e) {
                logger.error(`‚ùå Error dispatching event: ${e.message}`);
                logger.error(`   Stack: ${e.stack}`);
                updateStatus('Error: Could not dispatch', 'error');
            }
        }

        // Button click handlers
        keyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const key = button.dataset.key;
                button.style.transform = 'scale(0.95)';
                dispatchKeyboardEvent(key);
                setTimeout(() => { button.style.transform = ''; }, 100);
            });
        });

        // Keyboard shortcuts (F1-F4)
        document.addEventListener('keydown', (e) => {
            if (e.key.startsWith('F') && e.key.length === 2) {
                const keyNum = parseInt(e.key.slice(1));
                if (keyNum >= 1 && keyNum <= 4) {
                    // Don't prevent default - let browser handle F keys naturally
                    const button = document.querySelector(`[data-key="${e.key}"]`);
                    if (button) {
                        logger.warning(`üîë Physical ${e.key} key pressed on main document`);
                        logger.info(`   Note: This won't reach iframe. Click button or focus iframe first.`);
                    }
                }
            }
        });

        // Clear console
        clearButton.addEventListener('click', () => {
            logger.clear();
            updateStatus('Console cleared', 'info');
            logger.info('üìã Console cleared - Ready for new events');
        });

        // Initial status
        updateStatus('Ready - Load iframe first', 'success');
        updateFocusIndicator();
        logger.success('üöÄ System ready');
        logger.info('üìñ Workflow: Load Iframe ‚Üí Focus Iframe ‚Üí Send F1-F4');
    </script>
</body>
</html>
